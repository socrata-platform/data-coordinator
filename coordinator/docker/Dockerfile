FROM socrata/java8-bionic

EXPOSE 6020 6021
ENV JMX_PORT 6029
EXPOSE 6029

ENV SERVER_ROOT /srv/data-coordinator
ENV SERVER_ARTIFACT coordinator-assembly.jar
ENV SERVER_CONFIG data-coordinator.conf

# defaults
ENV ENABLE_GRAPHITE false
ENV GRAPHITE_HOST 0.0.0.0
ENV GRAPHITE_PORT 0
ENV JAVA_XMX 512m
ENV LOG_METRICS false
ENV DATA_COORDINATOR_DB_NAME truth
ENV DATA_COORDINATOR_DB_PORT 5432
ENV DATA_COORDINATOR_DB_USER soda_dc
ENV DATA_COORDINATOR_INSTANCE alpha
ENV DATA_COORDINATOR_COLLOCATION_GROUP [alpha]
ENV DATA_COORDINATOR_COLLOCATION_COST_MOVES_WEIGHT 100.0
ENV DATA_COORDINATOR_COLLOCATION_COST_TOTAL_SIZE_BYTES_WEIGHT 0.000000025
ENV DATA_COORDINATOR_COLLOCATION_COST_MOVE_SIZE_MAX_BYTES_WEIGHT 0.00000005
ENV JAVA_MAX_METASPACE 64m


WORKDIR $SERVER_ROOT

COPY ship.d /etc/ship.d
COPY ${SERVER_CONFIG}.j2 $SERVER_ROOT/
COPY $SERVER_ARTIFACT $SERVER_ROOT/
